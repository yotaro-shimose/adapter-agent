# 概要
LRPRをマスターしたLLMを作ることはコストやセキュリティ、新しいドメインでの活用の上で重要だ。しかしながらLRであるためにデータ収集が困難を極める。特にSFTデータの収集は不可能だ。

# 背景
### LRPRデータの自動生成はneedsベースで
- LRPR（Low-Resource Programming Languages）のデータは学習に利用可能な既存のデータがほとんどない
- そこでAIの力を使ってLRPRのデータを自動生成することを考えたい
- しかしながらライブラリの使い方をseedsから無数にサンプルすることはその組み合わせの膨大さから不可能
- したがってライブラリの使い方はneedsからサンプルする必要がある

### needsからのサンプルの課題
一方でneedsからサンプルするのには課題がある
- 新しいライブラリのneedsのサンプルは簡単でない
- needsをサンプルしたとしてもその問題を解く上でのサブ課題が大量にありAIが一番最初に解くべき難易度にならない
	- とくに知らないAPIの使い方など、試行錯誤で解決することは不可能
- するとAIはいつまでたっても性能が向上しない
	- Binary RLVRの課題

# ソリューション
### 既存課題からのサンプル
- ライブラリの説明をテキストでもっておく
- 既存のソフトウェアエンジニアリング課題をサンプルする

### AIの失敗からHindsight SFTデータを生成する
AIにソリューションを生成させるとAIはどこかで間違えるであろう。特に学習初期において、その間違いは大きなTaskを解く上で必要なSubtasksの１つを解くのに失敗している可能性が高い。(binary rewardの)RLVRの課題は、RLVRはAIが偶然にもRoot Taskを解決するソリューションをサンプルするまでSolutionが提供されないことにある。

そこで大きい問題を解く過程で直面した課題をhind sightで小さい問題と答えを自動生成する。
### 再帰的サブ課題サンプリング
1. SFTTaskPoolにTaskがいくつかセットされている状態からスタートする。
2. SFTTaskPoolからTaskをpopする
3. リファレンスも使いながらエージェントがとく。
4. Taskを解くのに成功したとエージェントが判断した場合
	1. SolverはTaskに対するSolutionを生成する
	2. VerifierはSolutionを（コードの実行などを通じて）検証する
	3. 検証に成功した場合
		1. Hindsightを活用したQRAをSFT Datasetに加える
		2. Verifiable TaskをRL Datasetに加える（ここの実装はあとで検討する）
		3. TaskをSFTTaskPoolから取り除く
	4. 検証に失敗した場合
		1. 少なくともこうしたら失敗したという知識をQRAとして生成する
5. Taskを解くのに失敗している状態がLターン続いているとエージェントが判断した場合またはTaskを解くのに必要な情報をエージェントが知らないと判断した場合またはBターンで課題を解けなかった場合
	1. AnalyzerにTrajectoryを渡す
	2. Trajectoryを読んでエージェントがわかっていない箇所に対応する新たなTaskを作成する
	3. このTaskをTaskPoolに追加する


### （補足）Solverが解ける問題のQRAしか生成されないことについて
解ける問題のQRAが生成されたとて、解ける問題が解けるようになるだけでは？という疑問について以下に反論する
- Solverは長大な試行錯誤が必要になっていたソリューションを小さいQRAへ圧縮する。このプロセスによりSolverは問題を解くときのReasoningを圧縮していける
- アクセスできる情報量
	- Solverは知識を内在化させるためにライブラリをよめない
	- Questionerは回答を作成するために好きなだけライブラリをみられる

### 懸念
- TaskPoolのサンプリング戦略
- Taskの重複対策(そんな課題じゃない気がしている)
- タスクの粒度がRootかPrivitiveしか存在していない問題（課題かもしれないが、一旦いいとしよう）
- [x] **SFTのデータがReasoningやTool call awareじゃないからTool Callに関する知識がどんどん失われていく恐れがある。**
	- hind sightからfull trajectoryを作り替えてSFTデータセットに加える
		- これむずすぎない？
	- ここはRLのカバレッジじゃないや
	- RLタスクを織り交ぜることでやっていきましょう
		- その場合reference見ない問題が現在のTaskPoolに入り込む余地がないことが気になる
- **エージェントの知識のアップデートがSolver以外に反映されない**
	- QRAからVerifierも賢くなれると仮定する？怪しいよなあ
	- →エージェントの行動履歴の要約したQAデータを生成する